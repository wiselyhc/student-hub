<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Notebook - S Study Hub</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        .font-logo { font-family: 'Cinzel Decorative', cursive; }
        [x-cloak] { display: none !important; }
        :root { --bg-color: #f3f4f6; --text-color: #1f2937; --text-muted-color: #6b7280; --card-bg-color: #ffffff; --border-color: #e5e7eb; --sidebar-bg-color: #ffffff; --sidebar-border-color: #e5e7eb; --active-icon-bg-color: #e5e7eb; --active-link-color: #1f2937; --active-tab-border-color: #111827; --input-bg-color: #ffffff; --input-border-color: #d1d5db; --focus-ring-color: #111827; --header-bg: rgba(255,255,255,0.8); --chatbar-bg: rgba(255,255,255,0.5); --bubble-user-bg: #ffffff; --bubble-ai-bg: #e5e7eb; --bubble-user-text: #1f2937; --bubble-ai-text: #1f2937; }
        .dark { --bg-color: #0f172a; --text-color: #cbd5e1; --text-muted-color: #94a3b8; --card-bg-color: #1e293b; --border-color: #334155; --sidebar-bg-color: #1e293b; --sidebar-border-color: #334155; --active-icon-bg-color: #334155; --active-link-color: #ffffff; --active-tab-border-color: #ffffff; --input-bg-color: #334155; --input-border-color: #475569; --focus-ring-color: #ffffff; --header-bg: rgba(15, 23, 42, 0.8); --chatbar-bg: rgba(30, 41, 59, 0.5); --bubble-user-bg: #334155; --bubble-ai-bg: #1e293b; --bubble-user-text: #ffffff; --bubble-ai-text: #cbd5e1; }
        .cyber { --bg-color: #0d0c22; --text-color: #a5b4fc; --text-muted-color: #818cf8; --card-bg-color: rgba(30, 41, 59, 0.7); --border-color: #4f46e5; --sidebar-bg-color: #1e293b; --sidebar-border-color: #a855f7; --active-icon-bg-color: #4338ca; --active-link-color: #c7d2fe; --active-tab-border-color: #67e8f9; --input-bg-color: rgba(30, 41, 59, 0.7); --input-border-color: #4f46e5; --focus-ring-color: #67e8f9; --header-bg: rgba(13,12,34,0.5); --chatbar-bg: rgba(30,41,59,0.5); --bubble-user-bg: #4338ca; --bubble-ai-bg: #1e293b; --bubble-user-text: #e0e7ff; --bubble-ai-text: #a5b4fc; }
        .forest { --bg-color: #052e16; --text-color: #a7f3d0; --text-muted-color: #6ee7b7; --card-bg-color: #064e3b; --border-color: #047857; --sidebar-bg-color: #064e3b; --sidebar-border-color: #047857; --active-icon-bg-color: #047857; --active-link-color: #ffffff; --active-tab-border-color: #a7f3d0; --input-bg-color: #064e3b; --input-border-color: #047857; --focus-ring-color: #a7f3d0; --header-bg: rgba(5, 46, 22, 0.8); --chatbar-bg: rgba(6, 78, 59, 0.5); --bubble-user-bg: #047857; --bubble-ai-bg: #064e3b; --bubble-user-text: #ffffff; --bubble-ai-text: #a7f3d0; }
        .ocean { --bg-color: #0c2444; --text-color: #a5b4fc; --text-muted-color: #818cf8; --card-bg-color: #1e3a8a; --border-color: #1d4ed8; --sidebar-bg-color: #1e3a8a; --sidebar-border-color: #1d4ed8; --active-icon-bg-color: #1d4ed8; --active-link-color: #ffffff; --active-tab-border-color: #a5b4fc; --input-bg-color: #1e3a8a; --input-border-color: #1d4ed8; --focus-ring-color: #a5b4fc; --header-bg: rgba(12, 36, 68, 0.8); --chatbar-bg: rgba(30, 58, 138, 0.5); --bubble-user-bg: #1d4ed8; --bubble-ai-bg: #1e3a8a; --bubble-user-text: #ffffff; --bubble-ai-text: #a5b4fc; }
        .sunset { --bg-color: #450a0a; --text-color: #fca5a5; --text-muted-color: #f87171; --card-bg-color: #7f1d1d; --border-color: #b91c1c; --sidebar-bg-color: #7f1d1d; --sidebar-border-color: #b91c1c; --active-icon-bg-color: #b91c1c; --active-link-color: #ffffff; --active-tab-border-color: #fca5a5; --input-bg-color: #7f1d1d; --input-border-color: #b91c1c; --focus-ring-color: #fca5a5; --header-bg: rgba(69, 10, 10, 0.8); --chatbar-bg: rgba(127, 29, 29, 0.5); --bubble-user-bg: #b91c1c; --bubble-ai-bg: #7f1d1d; --bubble-user-text: #ffffff; --bubble-ai-text: #fca5a5; }

        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: var(--border-color); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--text-muted-color); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: var(--text-color); }
    </style>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body 
    class="antialiased bg-[var(--bg-color)] text-[var(--text-color)] transition-colors duration-300"
    x-data="{ theme: localStorage.getItem('theme') || 'light' }"
    x-init="$watch('theme', val => localStorage.setItem('theme', val))"
    :class="{ 'dark': theme === 'dark', 'cyber': theme === 'cyber', 'forest': theme === 'forest', 'ocean': theme === 'ocean', 'sunset': theme === 'sunset' }">
    
    <nav class="fixed top-4 left-1/2 -translate-x-1/2 z-50">
        <div class="flex items-center space-x-2 bg-[var(--card-bg-color)]/80 backdrop-blur-lg border border-[var(--border-color)] rounded-full p-2 shadow-2xl transition-transform duration-300 ease-in-out hover:-translate-y-1">
            <a href="index.html" title="Home" class="p-3 rounded-full text-[var(--text-muted-color)] hover:bg-[var(--active-icon-bg-color)] hover:text-[var(--active-link-color)] transition-colors"><i data-lucide="home" class="w-6 h-6"></i></a>
            <a href="features.html" title="Features" class="p-3 rounded-full text-[var(--text-muted-color)] hover:bg-[var(--active-icon-bg-color)] hover:text-[var(--active-link-color)] transition-colors"><i data-lucide="wand-2" class="w-6 h-6"></i></a>
            <a href="books.html" title="My Library" class="p-3 rounded-full text-[var(--text-muted-color)] hover:bg-[var(--active-icon-bg-color)] hover:text-[var(--active-link-color)] transition-colors"><i data-lucide="library" class="w-6 h-6"></i></a>
            <a href="ai-notebook.html" title="S Notebook" class="p-3 rounded-full bg-[var(--active-icon-bg-color)] text-[var(--active-link-color)] transition-colors"><span class="font-logo w-6 h-6 flex items-center justify-center text-xl leading-none">S</span></a>
            <a href="contact.html" title="Contact" class="p-3 rounded-full text-[var(--text-muted-color)] hover:bg-[var(--active-icon-bg-color)] hover:text-[var(--active-link-color)] transition-colors"><i data-lucide="mail" class="w-6 h-6"></i></a>
            <a href="account-center.html" title="Account" class="p-3 rounded-full text-[var(--text-muted-color)] hover:bg-[var(--active-icon-bg-color)] hover:text-[var(--active-link-color)] transition-colors"><i data-lucide="user-circle-2" class="w-6 h-6"></i></a>
        </div>
    </nav>

    <main class="h-screen w-screen flex flex-col pt-24 pb-28">
        <div id="container" class="w-full max-w-4xl mx-auto flex-grow flex flex-col h-full">
            <div id="welcome-screen" class="flex flex-col items-center justify-center text-center h-full"><h1 class="text-8xl font-logo font-bold mb-8 text-[var(--text-color)]">S</h1><p class="text-2xl text-[var(--text-muted-color)] mb-8">How can I help you today?</p></div>
            <div id="chat-window" class="w-full h-full flex-grow overflow-y-auto custom-scrollbar p-4 space-y-4"></div>
        </div>
    </main>

    <div id="form-container" class="fixed bottom-0 left-0 right-0 z-30 p-4" x-data="{ attachMenuOpen: false }" @keydown.escape.window="attachMenuOpen = false">
        <div class="max-w-4xl mx-auto relative">
            <!-- Attachment Menu -->
            <div x-show="attachMenuOpen"
                 x-cloak
                 @click.outside="attachMenuOpen = false"
                 x-transition:enter="transition ease-out duration-100"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-75"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 class="absolute bottom-full mb-2 w-48 bg-[var(--card-bg-color)]/80 backdrop-blur-lg border border-[var(--border-color)] rounded-xl shadow-lg p-1.5">
                
                <button @click="document.getElementById('file-upload').click(); attachMenuOpen = false" class="w-full flex items-center space-x-3 px-3 py-2 text-left text-[var(--text-color)] hover:bg-[var(--active-icon-bg-color)] rounded-lg transition-colors text-sm">
                    <i data-lucide="image" class="w-4 h-4 text-[var(--text-muted-color)]"></i>
                    <span>Photo</span>
                </button>
                <button @click="document.getElementById('file-upload').click(); attachMenuOpen = false" class="w-full flex items-center space-x-3 px-3 py-2 text-left text-[var(--text-color)] hover:bg-[var(--active-icon-bg-color)] rounded-lg transition-colors text-sm">
                    <i data-lucide="file-text" class="w-4 h-4 text-[var(--text-muted-color)]"></i>
                    <span>Document</span>
                </button>
                <button @click="document.getElementById('file-upload').click(); attachMenuOpen = false" class="w-full flex items-center space-x-3 px-3 py-2 text-left text-[var(--text-color)] hover:bg-[var(--active-icon-bg-color)] rounded-lg transition-colors text-sm">
                    <i data-lucide="file" class="w-4 h-4 text-[var(--text-muted-color)]"></i>
                    <span>Other</span>
                </button>
            </div>

            <!-- Chat Form -->
            <form id="chat-form" class="flex items-center space-x-2 bg-[var(--chatbar-bg)] backdrop-blur-lg border border-[var(--border-color)] rounded-2xl p-2 shadow-lg">
                <button @click="attachMenuOpen = !attachMenuOpen" type="button" id="attach-button" class="flex-shrink-0 text-[var(--text-muted-color)] hover:text-[var(--text-color)] transition-colors p-2"><i data-lucide="paperclip" class="w-6 h-6"></i></button>
                <input type="file" id="file-upload" class="hidden">
                <input type="text" id="chat-input" placeholder="Ask me anything..." autocomplete="off" class="flex-grow bg-transparent border-none text-[var(--text-color)] focus:outline-none focus:ring-0 placeholder-[var(--text-muted-color)] text-lg py-2">
                <button type="button" class="flex-shrink-0 text-[var(--text-muted-color)] hover:text-[var(--text-color)] transition-colors p-2"><i data-lucide="mic" class="w-6 h-6"></i></button>
                <button type="submit" class="flex-shrink-0 text-[var(--text-muted-color)] hover:text-[var(--text-color)] transition-colors p-2 disabled:text-gray-300"><i data-lucide="send" class="w-6 h-6"></i></button>
            </form>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('container');
            const welcomeScreen = document.getElementById('welcome-screen');
            const chatWindow = document.getElementById('chat-window');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const submitButton = chatForm.querySelector('button[type="submit"]');
            const fileUpload = document.getElementById('file-upload');
            let chatHistory = [];

            container.classList.add('justify-center');

            const startChatSession = () => {
                if (welcomeScreen.style.display !== 'none') {
                    welcomeScreen.style.display = 'none';
                    container.classList.remove('justify-center');
                }
            };

            const formatMessage = (text) => {
                let html = text;
                html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                html = html.replace(/^#+\s/gm, '<br>');
                html = html.replace(/^\*\s/gm, '&bull; ');
                html = html.replace(/\n/g, '<br>');
                return html;
            };
            
            const addMessageToChat = (sender, message) => {
                const messageContainer = document.createElement('div');
                messageContainer.classList.add('flex', 'flex-col', 'max-w-[85%]');
                const labelElement = document.createElement('span');
                labelElement.classList.add('mb-1');
                const messageWrapper = document.createElement('div');
                messageWrapper.classList.add('p-3', 'rounded-xl', 'shadow-sm');
                const messageText = document.createElement('p');
                messageText.classList.add('leading-relaxed');
                
                if (sender === 'user') {
                    messageContainer.classList.add('self-end', 'items-end');
                    labelElement.textContent = 'You';
                    labelElement.classList.add('text-[var(--text-color)]', 'text-xs', 'font-bold');
                    messageText.textContent = message;
                    messageWrapper.classList.add('bg-[var(--bubble-user-bg)]');
                    messageText.classList.add('text-[var(--bubble-user-text)]');
                } else {
                    messageContainer.classList.add('self-start', 'items-start');
                    labelElement.innerHTML = `<span class="font-logo text-lg text-[var(--text-color)]">S</span>`;
                    messageText.innerHTML = formatMessage(message);
                    messageWrapper.classList.add('bg-[var(--bubble-ai-bg)]');
                    messageText.classList.add('text-[var(--bubble-ai-text)]');
                }
                messageContainer.appendChild(labelElement);
                messageContainer.appendChild(messageWrapper);
                messageWrapper.appendChild(messageText);
                chatWindow.appendChild(messageContainer);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            };

            const showTypingIndicator = () => {
                const typingElement = document.createElement('div');
                typingElement.id = 'typing-indicator';
                typingElement.classList.add('flex', 'flex-col', 'self-start', 'items-start');
                
                const labelElement = document.createElement('span');
                labelElement.classList.add('mb-1');
                labelElement.innerHTML = `<span class="font-logo text-lg text-[var(--text-color)]">S</span>`;
                
                const textElement = document.createElement('div');
                textElement.classList.add('p-3', 'rounded-xl', 'bg-[var(--bubble-ai-bg)]');
                textElement.innerHTML = `<p class="text-[var(--text-muted-color)] animate-pulse">Analyzing...</p>`;

                typingElement.appendChild(labelElement);
                typingElement.appendChild(textElement);
                chatWindow.appendChild(typingElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            };

            const removeTypingIndicator = () => {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) indicator.remove();
            };

            fileUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) { 
                    startChatSession();
                    addMessageToChat('user', `Uploaded file: ${file.name}`); 
                }
            });

            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userMessage = chatInput.value.trim();
                if (!userMessage) return;
                
                startChatSession();

                addMessageToChat('user', userMessage);
                chatHistory.push({ role: 'user', parts: [{ text: userMessage }] });
                chatInput.value = '';
                submitButton.disabled = true;
                showTypingIndicator();
                try {
                    const apiKey = ""; // API Key will be injected by the environment
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                    const systemPrompt = `You are S, a friendly, encouraging, and knowledgeable AI study assistant, with the personality of Gemini by Google. Communicate in a conversational and supportive tone. When explaining concepts, use clear, natural language. Use lists, bold text, and other formatting to structure your answers for readability, but strictly avoid using code blocks (\`\`\`) unless you are specifically asked to write code. Do not provide code for UI elements like navigation or positioning.`;
                    const payload = { contents: chatHistory, systemInstruction: { parts: [{ text: systemPrompt }] } };
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                    const result = await response.json();
                    const aiMessage = (result?.candidates?.[0]?.content?.parts?.[0]?.text) ? result.candidates[0].content.parts[0].text : "Sorry, I couldn't process that.";
                    removeTypingIndicator();
                    addMessageToChat('ai', aiMessage);
                    chatHistory.push({ role: 'model', parts: [{ text: aiMessage }] });
                } catch (error) {
                    console.error("Chat API Error:", error);
                    removeTypingIndicator();
                    addMessageToChat('ai', 'Sorry, I\'m having trouble connecting right now.');
                } finally {
                     submitButton.disabled = false;
                     chatInput.focus();
                }
            });

            lucide.createIcons();
        });
    </script>
</body>
</html>

